SQL Server Tetikleyicileri ve Ä°ÅŸlemleri (Triggers & Transactions) Ã–rnekleriBu belge, bir SQL Server betiÄŸi (trigger.sql) iÃ§inde yer alan Tetikleyiciler (Triggers) ve Ä°ÅŸlemler (Transactions) kavramlarÄ±na ait pratik Ã¶rneklerin detaylÄ± bir Ã¶zetini sunar.ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e AÃ§Ä±klamağŸ“ Proje BaÅŸlÄ±ÄŸÄ±SQL Server Tetikleyicileri ve Ä°ÅŸlemleri (Triggers & Transactions) Ã–rnekleriğŸ’¡ GiriÅŸBu SQL dosyasÄ±, SQL Server veritabanÄ± yÃ¶netim sisteminde kullanÄ±lan Tetikleyiciler (Triggers) ve Ä°ÅŸlemler (Transactions) kavramlarÄ±nÄ± gÃ¶stermektedir. Dosya, veritabanÄ± olaylarÄ±na (INSERT, UPDATE, DELETE gibi DML iÅŸlemleri) otomatik olarak tepki veren Ã¶zel saklÄ± yordamlar olan tetikleyicilerin nasÄ±l oluÅŸturulacaÄŸÄ±nÄ± ve kullanÄ±lacaÄŸÄ±nÄ± gÃ¶steren Ã§eÅŸitli Ã¶rnekler iÃ§ermektedir. AyrÄ±ca, veri bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ saÄŸlamak iÃ§in kullanÄ±lan iÅŸlem bloklarÄ±na (BEGIN TRANSACTION, COMMIT, ROLLBACK TRANSACTION) dair uygulamalar da mevcuttur.ğŸ”‘ Anahtar KavramlarKavram (Concept)TanÄ±m (Definition)DML TetikleyicileriINSERT, UPDATE ve DELETE gibi Veri ManipÃ¼lasyon Dili (DML) olaylarÄ±na yanÄ±t veren otomasyon mekanizmalarÄ±dÄ±r.AFTER/FOR TetikleyicileriDML olayÄ±ndan sonra Ã§alÄ±ÅŸan tetikleyicilerdir; genellikle denetim (logging) veya veri bÃ¼tÃ¼nlÃ¼ÄŸÃ¼ kontrollerinde kullanÄ±lÄ±rlar.Sanal TablolarTetikleyicilerin iÃ§inde, iÅŸlemden etkilenen verileri geÃ§ici olarak tutan Ã¶zel sanal tablolardÄ±r (INSERTED yeni veriyi, DELETED eski veriyi iÃ§erir).Ä°ÅŸlemler (Transactions)Bir dizi SQL komutunu tek bir mantÄ±ksal Ã§alÄ±ÅŸma birimi olarak yÃ¼rÃ¼ten bloklardÄ±r; ya hepsi baÅŸarÄ±lÄ± olur (COMMIT) ya da hepsi baÅŸarÄ±sÄ±z olursa geri alÄ±nÄ±r (ROLLBACK).Kontrol KomutlarÄ±BEGIN TRAN (baÅŸlatÄ±r), COMMIT TRAN (onaylar), ROLLBACK TRAN (geri alÄ±r) ve SAVE TRANSACTION (kayÄ±t noktasÄ± oluÅŸturur).ğŸ› ï¸ Dosya Ä°Ã§eriÄŸi Ã–zetiKategoriÄ°ÅŸlemlerDenetim (Audit) TetikleyicileritrgAnektSonuc, dbo.trgEmployeeUpdate, dbo.trgEmployeeInsert, trgAnketSonuc: Ã‡eÅŸitli tablolar Ã¼zerinde INSERT ve UPDATE iÅŸlemlerini loglama Ã¶rnekleri.Veri GiriÅŸi Ã–rneÄŸiKisi tablosuna veri ekleme (INSERT komutu).KarmaÅŸÄ±k TetikleyicitrgAnketSonucInsert: Kisi tablosu iÃ§in AFTER INSERT tetikleyicisi (AyrÄ±ntÄ±lÄ± analiz aÅŸaÄŸÄ±dadÄ±r).Rastgele Veri SeÃ§imiKisi tablosundan rastgele bir kayÄ±t seÃ§me Ã¶rneÄŸi (NEWID() kullanÄ±mÄ±).Ä°ÅŸlem (Transaction) Ã–rnekleriSAVE TRANSACTION ve ROLLBACK TRANSACTION ile kÄ±smi geri alma, @@TRANCOUNT ile aÃ§Ä±k iÅŸlem sayÄ±sÄ±nÄ± kontrol etme.âš ï¸ HatalÄ± Tetikleyici Analizi: trgAnketSonucInsertDosyada yer alan trgAnketSonucInsert adlÄ± tetikleyici, potansiyel olarak hatalÄ± bir tasarÄ±ma sahiptir:AmaÃ§: Tetikleyici, Kisi tablosuna bir ekleme yapÄ±ldÄ±ktan sonra Ã§alÄ±ÅŸÄ±r.Hata NoktasÄ±: Tetikleyici bloÄŸunun sonunda, Insert Into Kisi(...) Values(...) ifadesi yer alÄ±r. Bu ifade, tetikleyicinin baÄŸlÄ± olduÄŸu aynÄ± tabloya yeni bir kayÄ±t eklemeye Ã§alÄ±ÅŸÄ±r.SonuÃ§: Bu ikinci INSERT iÅŸlemi, aynÄ± tetikleyiciyi tekrar tetikler. VarsayÄ±lan olarak iÃ§ iÃ§e tetikleyicilere izin veren bir SQL Server ortamÄ±nda bu durum, sunucunun izin verdiÄŸi maksimum iÃ§ iÃ§e tetikleyici seviyesine ulaÅŸana kadar zincirleme bir reaksiyona (sonsuz dÃ¶ngÃ¼ye benzer) yol aÃ§arak iÅŸlemin baÅŸarÄ±sÄ±z olmasÄ±na neden olur. Denetim amaÃ§lÄ± tetikleyicilerde bu tÃ¼r dÃ¶ngÃ¼sel iÅŸlemlerden kesinlikle kaÃ§Ä±nÄ±lmalÄ±dÄ±r.SQL Server Triggers and Transactions ExamplesThis document provides a detailed summary of the practical examples for Triggers and Transactions concepts contained within an SQL Server script (trigger.sql).ğŸ‡¬ğŸ‡§ English ExplanationğŸ“ Project TitleSQL Server Triggers and Transactions ExamplesğŸ’¡ IntroductionThis SQL file demonstrates the concepts of Triggers and Transactions used within the SQL Server database management system. The file contains various examples illustrating how to create and use triggersâ€”special stored procedures that automatically respond to database events (DML operations like INSERT, UPDATE, DELETE). It also includes applications of transaction blocks (BEGIN TRANSACTION, COMMIT, ROLLBACK TRANSACTION) used to ensure data integrity.ğŸ”‘ Key ConceptsConceptDefinitionDML TriggersAutomation mechanisms that respond to Data Manipulation Language (DML) events such as INSERT, UPDATE, and DELETE.AFTER/FOR TriggersTriggers that execute after the DML event; they are commonly used for auditing (logging) or data integrity checks.Virtual TablesSpecial virtual tables that temporarily hold the data affected by the operation inside the triggers (INSERTED contains new data, DELETED contains old data).TransactionsBlocks that execute a series of SQL commands as a single logical unit of work; either all succeed (COMMIT) or all are reverted if any fail (ROLLBACK).Control CommandsBEGIN TRAN (starts), COMMIT TRAN (confirms), ROLLBACK TRAN (reverts), and SAVE TRANSACTION (creates a savepoint).ğŸ› ï¸ File Content SummaryCategoryOperationsAuditing TriggerstrgAnektSonuc, dbo.trgEmployeeUpdate, dbo.trgEmployeeInsert, trgAnketSonuc: Examples of logging INSERT and UPDATE operations on various tables.Data Insertion ExampleInserting data into the Kisi table (INSERT command).Complex TriggertrgAnketSonucInsert: An AFTER INSERT trigger for the Kisi table (Detailed analysis below).Random Data SelectionExample of selecting a random record from the Kisi table (using NEWID()).Transaction ExamplesPartial rollback using SAVE TRANSACTION and ROLLBACK TRANSACTION, checking the number of open transactions with @@TRANCOUNT.âš ï¸ Analysis of the Erroneous Trigger: trgAnketSonucInsertThe trgAnketSonucInsert trigger in the file has a potentially flawed design:Purpose: The trigger executes after an insertion into the Kisi table.Point of Error: At the end of the trigger block, the statement Insert Into Kisi(...) Values(...) is present. This statement attempts to insert a new record into the very same table that the trigger is bound to.Result: This second INSERT operation will fire the same trigger again. In a SQL Server environment that allows nested triggers by default, this leads to a cascading reaction (similar to an infinite loop) until the maximum allowed nesting level is reached, causing the operation to fail. Such recursive operations must be strictly avoided in auditing triggers.
